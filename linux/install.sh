#!/usr/bin/env bash
set -euo pipefail

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#  ๐จ Git Hooks Setup Script
#  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

# Color definitions
RESET="\033[0m"
BOLD="\033[1m"
GREEN="\033[32m"
YELLOW="\033[33m"
CYAN="\033[36m"
RED="\033[31m"

# Directories
DOTFILES_DIR="$HOME/.dotfiles"
HOOKS_SOURCE_DIR="$DOTFILES_DIR/linux/git-hooks"
HOOKS_TARGET_DIR="$HOME/.git_hooks"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#  ๐๏ธ  Functions
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

info() {
  printf "${CYAN}%s${RESET}\n" "โ $*"
}

success() {
  printf "${GREEN}%s${RESET}\n" "โ $*"
}

warning() {
  printf "${YELLOW}%s${RESET}\n" "โ $*"
}

error() {
  printf "${RED}%s${RESET}\n" "โ $*" >&2
  exit 1
}

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#  ๐ Pre-flight Checks
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

[ -d "$HOOKS_SOURCE_DIR" ] || error "Hooks source directory not found: $HOOKS_SOURCE_DIR"
info "Found hooks in $HOOKS_SOURCE_DIR"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#  ๐ Create Target Directory
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

info "Ensuring hooks directory exists at $HOOKS_TARGET_DIR..."
mkdir -p "$HOOKS_TARGET_DIR"
success "Directory ready: $HOOKS_TARGET_DIR"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#  ๐งน Clean Existing Hooks
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

if compgen -G "$HOOKS_TARGET_DIR/*" > /dev/null; then
  warning "Removing existing hooks in $HOOKS_TARGET_DIR..."
  rm -f "$HOOKS_TARGET_DIR"/*
  success "Old hooks cleared"
else
  info "No existing hooks to remove"
fi

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#  ๐ Symlink and Make Executable
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

info "Linking new hooks..."
for src in "$HOOKS_SOURCE_DIR"/*; do
  name="$(basename "$src")"
  target="$HOOKS_TARGET_DIR/$name"

  ln -sf "$src" "$target"
  chmod +x "$target"

  success "Linked & made executable: $name"
done

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#  โ๏ธ  Configure Git
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

info "Setting Git core.hooksPath to $HOOKS_TARGET_DIR..."
git config --global core.hooksPath "$HOOKS_TARGET_DIR"
success "Git hooksPath configured"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
#  ๐ Done!
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

printf "\n${BOLD}${GREEN}Git hooks setup complete!${RESET}\n"
